---
name: 修复首页工作目录选择器问题
overview: 修复首页中间工作目录选择器的两个问题：1) 选择目录后不回显；2) 宽度太窄显示不完整。
todos:
  - id: fix-width
    content: 修改 WorkingDirSelector 组件，增大宽度限制以完整显示路径
    status: completed
  - id: fix-save-logic
    content: 修复 App.tsx 中目录选择后的保存逻辑，使用正确的 settingsApi.save 方法
    status: completed
---

## 问题概述

修复首页工作目录选择器的两个问题：

1. **选择目录后不回显** - 选择目录后界面没有更新显示选中的路径
2. **宽度太窄** - 目录路径显示被截断，无法完整显示

## 问题分析

1. **宽度问题**：`WorkingDirSelector` 组件中使用了 `max-w-[180px]` 限制宽度，导致路径显示被截断
2. **回显问题**：`App.tsx` 中调用了 `settingsApi.update()` 方法，但 `settingsApi` 对象中不存在 `update` 方法。正确的方法应该是先获取当前设置，然后更新 `terminalWorkingDir` 字段，最后调用 `settingsApi.save()` 保存

## 技术栈

- 前端框架：React + TypeScript
- UI 组件库：shadcn/ui
- 状态管理：TanStack Query (React Query)
- Tauri 后端：Rust

## 实现方案

### 1. 宽度问题修复

修改 `WorkingDirSelector.tsx`，移除或增大 `max-w-[180px]` 限制，使路径能够完整显示。考虑到布局空间，将宽度限制调整为更大的值或使用自适应宽度。

### 2. 回显问题修复

修改 `App.tsx` 中的 `handleBrowseWorkingDir` 和 `handleClearWorkingDir` 函数：

- 先调用 `settingsApi.get()` 获取当前设置
- 更新 `terminalWorkingDir` 字段
- 调用 `settingsApi.save()` 保存设置
- 然后调用 `refetchSettings()` 刷新界面

## 目录结构

```
src/
├── components/
│   └── providers/
│       └── WorkingDirSelector.tsx    # [MODIFY] 调整宽度限制
├── App.tsx                           # [MODIFY] 修复 settingsApi.update 调用
└── lib/api/
    └── settings.ts                   # [参考] 确认 API 方法
```